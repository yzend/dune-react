import { Meta, Controls } from "@storybook/addon-docs/blocks";
import ParamsTable from "../../StoryComponents/ParamsTable";

<Meta title="Utils/utils-canvas/blobToBase64(Blob转Base64)" />

# blobToBase64

### 功能描述

将 Blob 对象转换为 Base64 字符串，返回一个 Promise，支持异步处理大文件。

### 参数说明

<ParamsTable
  params={[
    {
      name: "blob",
      type: "Blob",
      required: true,
      description: "要转换的 Blob 对象",
    },
  ]}
/>

### 返回值

- **类型**: Promise&lt;string&gt;
- **描述**: 返回 Base64 字符串的 Promise

### 使用示例

```typescript
import { blobToBase64 } from "dune-react/utils";

// 处理文件上传并转换为 Base64
const fileInput = document.querySelector('input[type="file"]');
fileInput.addEventListener("change", async (e) => {
  const file = e.target.files[0];
  if (file) {
    try {
      const base64 = await blobToBase64(file);
      console.log(base64); // "data:image/png;base64,iVBORw0KGgoAAAANSUhEUg..."

      // 发送到服务器
      await fetch("/api/upload", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ image: base64 }),
      });
    } catch (error) {
      console.error("转换失败:", error);
    }
  }
});

// 处理 Canvas 导出的 Blob
const canvas = document.createElement("canvas");
canvas.toBlob(async (blob) => {
  if (blob) {
    const base64 = await blobToBase64(blob);
    // 保存到本地存储
    localStorage.setItem("canvas-image", base64);
  }
}, "image/png");

// 处理网络请求返回的 Blob
fetch("/api/image")
  .then((response) => response.blob())
  .then(async (blob) => {
    const base64 = await blobToBase64(blob);
    const img = document.createElement("img");
    img.src = base64;
    document.body.appendChild(img);
  });
```

### 特性

- ✅ 异步处理，不阻塞主线程
- ✅ 支持大文件转换
- ✅ 自动生成 data URL 格式
- ✅ 错误处理机制

### 注意事项

- 大文件转换可能需要较长时间
- 建议在 Web Worker 中处理超大文件
- 生成的 Base64 字符串会比原文件大约 33%
